<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I-Voice - Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>
    <!-- Add these script tags before closing </head> tag -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <!-- Add this RIGHT BEFORE your existing <script> tag in index.html -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
    // Initialize Supabase with YOUR credentials
    const SUPABASE_URL = 'https://kwmwcrcmihofvsaugciu.supabase.co'
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3bXdjcmNtaWhvZnZzYXVnY2l1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY3NTQwNjgsImV4cCI6MjA3MjMzMDA2OH0.gvioiJOYmIWObQ9rMwDt2KRhiigZiger5IJKUZ_Cqfk'

    // Wait for page to load, then initialize Supabase
    window.addEventListener('DOMContentLoaded', function() {
        // Initialize Supabase client
        window.supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        console.log('Supabase initialized successfully!');
    });
    </script>

    <script>
    // Add this for debugging - remove after testing
    window.addEventListener('load', function() {
        console.log('Page loaded');
        console.log('Supabase available:', typeof supabase !== 'undefined');
        console.log('Supabase client:', window.supabaseClient);
    });
    </script>

</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <!-- Enhanced Professional Header -->
<header class="header">
    <div class="header-content">
        <div class="header-left">
            <div class="logo">
                <img src="assets/logo.png" alt="I-Voice Logo" class="logo-image">
                <span class="logo-text">I-Voice</span>
            </div>
        </div>
        
        <div class="header-center">
            <h1 class="page-title" id="pageTitle">Dashboard</h1>
        </div>
        
        <div class="header-right">
            <span class="welcome-text" id="userName">Welcome, User!</span>
            <div class="user-info">
                
                <div class="profile-menu">
                    <button class="profile-btn" onclick="toggleProfileMenu()">
                        <div class="profile-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <i class="fas fa-chevron-down dropdown-arrow"></i>
                    </button>
                    <div class="profile-dropdown" id="profileDropdown">
                        <div class="dropdown-item" onclick="openProfileModal()">
                            <i class="fas fa-user-edit"></i>
                            <span>My Profile</span>
                        </div>
                        <div class="dropdown-item" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Logout</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Enhanced Navigation -->
<nav class="nav-tabs">
    <button class="tab-btn active" data-tab="dashboard" onclick="showTab('dashboard')">
        <i class="fas fa-tachometer-alt"></i>
        <span>Dashboard</span>
    </button>
    <button class="tab-btn" data-tab="parties" onclick="showTab('parties')">
        <i class="fas fa-users"></i>
        <span>Parties</span>
    </button>
    <button class="tab-btn" data-tab="items" onclick="showTab('items')">
        <i class="fas fa-box"></i>
        <span>Items</span>
    </button>
    <button class="tab-btn" data-tab="invoices" onclick="showTab('invoices')">
        <i class="fas fa-file-invoice"></i>
        <span>Invoices</span>
    </button>
    <button class="tab-btn" data-tab="reports" onclick="showTab('reports')">
        <i class="fas fa-chart-bar"></i>
        <span>Reports</span>
    </button>
</nav>


        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <!-- Modern Dashboard Cards -->
<div class="dashboard-cards">
    <div class="card modern-card sales-card">
        <div class="card-icon">
        </div>
        <div class="card-content">
            <h3>Total Sales</h3>
            <div class="amount" id="totalSales">₹0</div>
            <div class="card-trend positive">
                <i class="fas fa-arrow-up"></i>
                <span>+12.5%</span>
            </div>
        </div>
    </div>
    
    <div class="card modern-card outstanding-card">
        <div class="card-icon">
            <i class="fas fa-clock"></i>
        </div>
        <div class="card-content">
            <h3>Outstanding</h3>
            <div class="amount" id="totalOutstanding">₹0</div>
            <div class="card-trend negative">
                <i class="fas fa-arrow-down"></i>
                <span>-3.2%</span>
            </div>
        </div>
    </div>
    
    <div class="card modern-card items-card">
        <div class="card-icon">
            <i class="fas fa-cube"></i>
        </div>
        <div class="card-content">
            <h3>Items</h3>
            <div class="amount" id="totalItems">0</div>
            <div class="card-info">Total Products</div>
        </div>
    </div>
    
    <div class="card modern-card parties-card">
        <div class="card-icon">
        </div>
        <div class="card-content">
            <h3>Parties</h3>
            <div class="amount" id="totalParties">0</div>
            <div class="card-info">Active Customers</div>
        </div>
    </div>
</div>

            
            <div class="quick-actions">
                <button class="action-btn" onclick="showTab('parties')">Parties</button>
                <button class="action-btn" onclick="createNewInvoice()">Invoices</button>
                <button class="action-btn" onclick="showTab('items')">Items</button>
            </div>


            <h3>Recent Invoices</h3>
            <div id="dashboardInvoicesList" class="dashboard-invoices"></div>
        </div>

        <!-- Parties Tab -->
        <div id="parties" class="tab-content">
            <div class="tab-header">
                <h2>Parties</h2>
                <button class="btn-primary" onclick="showAddPartyModal()">+ New Party</button>
            </div>
            
            <div class="search-box">
                <input type="text" id="partySearch" placeholder="Search parties..." oninput="searchParties()">
            </div>
            
            <div id="partiesList" class="list-container"></div>
        </div>

        <!-- Items Tab -->
        <div id="items" class="tab-content">
            <div class="tab-header">
                <h2>Items</h2>
                <button class="btn-primary" onclick="showAddItemModal()">+ New Item</button>
            </div>
            
            <div class="search-box">
                <input type="text" id="itemSearch" placeholder="Search items..." oninput="searchItems()">
            </div>
            
            <div id="itemsList" class="list-container"></div>
        </div>

        <!-- Invoices Tab -->
        <div id="invoices" class="tab-content">
            <div class="tab-header">
                <h2>Invoices</h2>
                <button class="btn-primary" onclick="createNewInvoice()">+ New Invoice</button>
            </div>
            
            <div id="invoicesList" class="list-container"></div>
        </div>

        <!-- Reports Tab -->
        <div id="reports" class="tab-content">
            <h2>Reports</h2>
            <div class="reports-grid">
                <div class="report-card" onclick="generateSalesReport()">
                    <h3>Sales Report</h3>
                    <p>View detailed sales analytics</p>
                </div>
                <div class="report-card" onclick="generatePartyReport()">
                    <h3>Party Report</h3>
                    <p>Outstanding and payment details</p>
                </div>
                <div class="report-card" onclick="generateItemReport()">
                    <h3>Inventory Report</h3>
                    <p>Stock levels and item details</p>
                </div>
            </div>
        </div>

        <!-- Modals -->
        <!-- Add Party Modal -->
        <div id="addPartyModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Add New Party</h3>
                    <span class="close" onclick="closeModal('addPartyModal')">&times;</span>
                </div>
                <form onsubmit="addParty(event)">
                    <div class="form-group">
                        <label>Party Name *</label>
                        <input type="text" id="partyName" required>
                    </div>
                    <div class="form-group">
                        <label>Phone Number *</label>
                        <input type="tel" id="partyPhone" required>
                    </div>
                    <div class="form-group">
                        <label>Email (Optional)</label>
                        <input type="email" id="partyEmail">
                    </div>
                    <div class="form-group">
                        <label>GST Number</label>
                        <input type="text" id="partyGST" placeholder="e.g., 37BFHPC8175F1ZC">
                    </div>
                    <div class="form-group">
                        <label>Address *</label>
                        <textarea id="partyAddress" rows="3" required></textarea>
                    </div>
                    <div class="form-group">
                        <label>State</label>
                        <select id="partyState" required>
                            <option value="">Select State</option>
                            <option value="01-Jammu and Kashmir">01-Jammu and Kashmir</option>
                            <option value="02-Himachal Pradesh">02-Himachal Pradesh</option>
                            <option value="03-Punjab">03-Punjab</option>
                            <option value="04-Chandigarh">04-Chandigarh</option>
                            <option value="05-Uttarakhand">05-Uttarakhand</option>
                            <option value="06-Haryana">06-Haryana</option>
                            <option value="07-Delhi">07-Delhi</option>
                            <option value="08-Rajasthan">08-Rajasthan</option>
                            <option value="09-Uttar Pradesh">09-Uttar Pradesh</option>
                            <option value="10-Bihar">10-Bihar</option>
                            <option value="11-Sikkim">11-Sikkim</option>
                            <option value="12-Arunachal Pradesh">12-Arunachal Pradesh</option>
                            <option value="13-Nagaland">13-Nagaland</option>
                            <option value="14-Manipur">14-Manipur</option>
                            <option value="15-Mizoram">15-Mizoram</option>
                            <option value="16-Tripura">16-Tripura</option>
                            <option value="17-Meghalaya">17-Meghalaya</option>
                            <option value="18-Assam">18-Assam</option>
                            <option value="19-West Bengal">19-West Bengal</option>
                            <option value="20-Jharkhand">20-Jharkhand</option>
                            <option value="21-Orissa">21-Orissa</option>
                            <option value="22-Chhattisgarh">22-Chhattisgarh</option>
                            <option value="23-Madhya Pradesh">23-Madhya Pradesh</option>
                            <option value="24-Gujarat">24-Gujarat</option>
                            <option value="25-Daman and Diu">25-Daman and Diu</option>
                            <option value="26-Dadra and Nagar Haveli">26-Dadra and Nagar Haveli</option>
                            <option value="27-Maharashtra">27-Maharashtra</option>
                            <option value="28-Andhra Pradesh">28-Andhra Pradesh</option>
                            <option value="29-Karnataka">29-Karnataka</option>
                            <option value="30-Goa">30-Goa</option>
                            <option value="31-Lakshadweep">31-Lakshadweep</option>
                            <option value="32-Kerala">32-Kerala</option>
                            <option value="33-Tamil Nadu">33-Tamil Nadu</option>
                            <option value="34-Puducherry">34-Puducherry</option>
                            <option value="35-Andaman and Nicobar Islands">35-Andaman and Nicobar Islands</option>
                            <option value="36-Telangana">36-Telangana</option>
                            <option value="37-Andhra Pradesh">37-Andhra Pradesh</option>
                        </select>
                    </div>
                    <div class="form-buttons">
                        <button type="submit" class="btn btn-primary">Save</button>
                        <button type="button" class="btn btn-secondary" onclick="closeModal('addPartyModal')">Cancel</button>
                    </div>
                </form>
            </div>
        </div>


        <!-- Add Item Modal -->
        <div id="addItemModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Add New Item</h3>
                    <span class="close" onclick="closeModal('addItemModal')">&times;</span>
                </div>
                <form onsubmit="addItem(event)">
                    <div class="form-group">
                        <label>Item Name *</label>
                        <input type="text" id="itemName" required>
                    </div>
                    <div class="form-group">
                        <label>HSN/SAC Code</label>
                        <input type="text" id="itemHSN" placeholder="e.g., 8402">
                    </div>
                    <div class="form-group">
                        <label>Unit</label>
                        <select id="itemUnit">
                            <option value="Nos">Nos</option>
                            <option value="Kg">Kg</option>
                            <option value="Ltr">Ltr</option>
                            <option value="Mtr">Mtr</option>
                            <option value="Pcs">Pcs</option>
                            <option value="Box">Box</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Rate (Price/Unit) *</label>
                        <input type="number" id="itemRate" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>GST Rate</label>
                        <select id="itemGSTRate">
                            <option value="0">None (0%)</option>
                            <option value="0">Exempt (0%)</option>
                            <option value="0.25">IGST@0.25%</option>
                            <option value="3">IGST@3%</option>
                            <option value="5">IGST@5%</option>
                            <option value="12">IGST@12%</option>
                            <option value="18" selected>IGST@18%</option>
                            <option value="28">IGST@28%</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Stock Quantity</label>
                        <input type="number" id="itemStock" value="0">
                    </div>
                    <div class="form-buttons">
                        <button type="submit" class="btn btn-primary">Save</button>
                        <button type="button" class="btn btn-secondary" onclick="closeModal('addItemModal')">Cancel</button>
                    </div>
                </form>
            </div>
        </div>


        <!-- Invoice Modal -->
        <div id="invoiceModal" class="modal">
            <div class="modal-content large">
                <div class="modal-header">
                    <h3>Create Invoice</h3>
                    <span class="close" onclick="closeModal('invoiceModal')">&times;</span>
                </div>
                <div class="invoice-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <label class="switch">
                                    <input type="checkbox" id="invoiceNumberToggle" checked>
                                    <span class="slider"></span>
                                </label>
                                <span>Auto</span>
                                Invoice Number
                            </label>
                            <input type="text" id="invoiceNumber" readonly style="background-color: #f0f0f0;">
                        </div>
                        <div class="form-group">
                            <label>Invoice Date</label>
                            <input type="date" id="invoiceDate" required>
                        </div>
                    </div>

                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Select Party *</label>
                            <select id="invoiceParty" required onchange="updatePartyDetails()">
                                <option value="">Choose Party...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Payment Type</label>
                            <select id="paymentType">
                                <option value="Credit">Credit</option>
                                <option value="Cash">Cash</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>PO Date</label>
                            <input type="date" id="poDate">
                        </div>
                        <div class="form-group">
                            <label>PO Number</label>
                            <input type="text" id="poNumber">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>E-Way Bill No.</label>
                        <input type="text" id="eWayBill">
                    </div>
                    
                    <h4>Invoice Items</h4>
                    <div class="items-section">
                        <div class="item-row">
                            <select class="item-select" onchange="updateItemDetails(this)">
                                <option value="">Select Item...</option>
                            </select>
                            <input type="number" class="item-qty" placeholder="Qty" min="1" onchange="calculateItemTotal(this)">
                            <input type="number" class="item-rate" placeholder="Rate" step="0.01" onchange="calculateItemTotal(this)">
                            <input type="number" class="item-total" placeholder="Total" readonly>
                            <button type="button" class="btn-remove" onclick="removeItemRow(this)">×</button>
                        </div>
                    </div>
                    <button type="button" class="btn-add-item" onclick="addItemRow()">+ Add Item</button>
                    
                    <div class="invoice-totals">
                        <div class="total-row">
                            <span>Subtotal:</span>
                            <span id="invoiceSubtotal">₹0.00</span>
                        </div>
                        <div class="total-row">
                            <span>Total Tax:</span>
                            <span id="invoiceTax">₹0.00</span>
                        </div>
                        <div class="total-row final">
                            <span>Total Amount:</span>
                            <span id="invoiceTotal">₹0.00</span>
                        </div>
                        <div class="total-row">
                            <span>Received:</span>
                            <input type="number" id="receivedAmount" step="0.01" value="0" onchange="calculateBalance()">
                        </div>
                        <div class="total-row balance">
                            <span>Balance Due:</span>
                            <span id="balanceDue" style="color: #e74c3c; font-weight: bold;">₹0.00</span>
                        </div>
                    </div>
                    
                    <div class="form-buttons">
                        <button type="button" class="btn btn-primary" onclick="saveInvoice()">Save Invoice</button>
                        <button type="button" class="btn btn-secondary" onclick="closeModal('invoiceModal')">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <!-- Add this notification system before closing </body> tag -->
    <div id="notificationContainer" class="notification-container"></div>

    <!-- Profile Modal -->
<div id="profileModal" class="modal">
    <div class="modal-content profile-modal">
        <div class="modal-header">
            <h2>
                <i class="fas fa-user-circle"></i>
                Business Profile
            </h2>
            <span class="close" onclick="closeProfileModal()">&times;</span>
        </div>
        
        <form id="profileForm" class="profile-form">
            <div class="form-section">
                <h3>Company Information</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="companyName">Company Name *</label>
                        <input type="text" id="companyName" required>
                    </div>
                    <div class="form-group">
                        <label for="businessType">Business Type</label>
                        <input type="text" id="businessType" placeholder="e.g., MFRS STEAM & BOILER EQUIPMENTS">
                    </div>
                </div>
            </div>
            
            <div class="form-section">
                <h3>Contact Details</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="profilePhone">Phone Number *</label>
                        <input type="tel" id="profilePhone" required>
                    </div>
                    <div class="form-group">
                        <label for="profileEmail">Email Address *</label>
                        <input type="email" id="profileEmail" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="website">Website</label>
                    <input type="url" id="website" placeholder="https://www.yourcompany.com">
                </div>
            </div>
            
            <div class="form-section">
                <h3>Address Information</h3>
                <div class="form-group">
                    <label for="profileAddress">Address *</label>
                    <textarea id="profileAddress" rows="3" required></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="city">City *</label>
                        <input type="text" id="city" required>
                    </div>
                    <div class="form-group">
                        <label for="profileState">State *</label>
                        <select id="profileState" required>
                            <option value="">Select State</option>
                            <option value="01-Jammu and Kashmir">01-Jammu and Kashmir</option>
                            <option value="02-Himachal Pradesh">02-Himachal Pradesh</option>
                            <option value="03-Punjab">03-Punjab</option>
                            <option value="04-Chandigarh">04-Chandigarh</option>
                            <option value="05-Uttarakhand">05-Uttarakhand</option>
                            <option value="06-Haryana">06-Haryana</option>
                            <option value="07-Delhi">07-Delhi</option>
                            <option value="08-Rajasthan">08-Rajasthan</option>
                            <option value="09-Uttar Pradesh">09-Uttar Pradesh</option>
                            <option value="10-Bihar">10-Bihar</option>
                            <option value="11-Sikkim">11-Sikkim</option>
                            <option value="12-Arunachal Pradesh">12-Arunachal Pradesh</option>
                            <option value="13-Nagaland">13-Nagaland</option>
                            <option value="14-Manipur">14-Manipur</option>
                            <option value="15-Mizoram">15-Mizoram</option>
                            <option value="16-Tripura">16-Tripura</option>
                            <option value="17-Meghalaya">17-Meghalaya</option>
                            <option value="18-Assam">18-Assam</option>
                            <option value="19-West Bengal">19-West Bengal</option>
                            <option value="20-Jharkhand">20-Jharkhand</option>
                            <option value="21-Orissa">21-Orissa</option>
                            <option value="22-Chhattisgarh">22-Chhattisgarh</option>
                            <option value="23-Madhya Pradesh">23-Madhya Pradesh</option>
                            <option value="24-Gujarat">24-Gujarat</option>
                            <option value="25-Daman and Diu">25-Daman and Diu</option>
                            <option value="26-Dadra and Nagar Haveli">26-Dadra and Nagar Haveli</option>
                            <option value="27-Maharashtra">27-Maharashtra</option>
                            <option value="28-Andhra Pradesh">28-Andhra Pradesh</option>
                            <option value="29-Karnataka">29-Karnataka</option>
                            <option value="30-Goa">30-Goa</option>
                            <option value="31-Lakshadweep">31-Lakshadweep</option>
                            <option value="32-Kerala">32-Kerala</option>
                            <option value="33-Tamil Nadu">33-Tamil Nadu</option>
                            <option value="34-Puducherry">34-Puducherry</option>
                            <option value="35-Andaman and Nicobar Islands">35-Andaman and Nicobar Islands</option>
                            <option value="36-Telangana">36-Telangana</option>
                            <option value="37-Andhra Pradesh">37-Andhra Pradesh</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="pincode">Pincode *</label>
                        <input type="text" id="pincode" required>
                    </div>
                </div>
            </div>
            
            <div class="form-section">
                <h3>Tax Information</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="gstNumber">GST Number</label>
                        <input type="text" id="gstNumber" placeholder="22AAAAA0000A1Z5">
                    </div>
                    <div class="form-group">
                        <label for="panNumber">PAN Number</label>
                        <input type="text" id="panNumber" placeholder="AAAAA0000A">
                    </div>
                </div>
            </div>
            
            <div class="form-section">
                <h3>Banking Details</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="bankName">Bank Name</label>
                        <input type="text" id="bankName">
                    </div>
                    <div class="form-group">
                        <label for="accountNumber">Account Number</label>
                        <input type="text" id="accountNumber">
                    </div>
                </div>
                <div class="form-group">
                    <label for="ifscCode">IFSC Code</label>
                    <input type="text" id="ifscCode">
                </div>
            </div>
            
            <div class="form-buttons">
                <button type="button" class="btn btn-secondary" onclick="closeProfileModal()">Cancel</button>
                <button type="button" class="btn btn-primary" id="editProfileBtn" onclick="enableProfileEdit()">Edit</button>
                <button type="submit" class="btn btn-primary" id="saveProfileBtn">Save Profile</button>
            </div>
        </form>
    </div>
</div>


    <script src="script.js"></script>

</body>
</html>